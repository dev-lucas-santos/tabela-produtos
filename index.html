<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="responsivo.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" 
    integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
   
    <title>Tabela de Produtos</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        .table-wrapper { max-height: 320px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: left; background: white; }
        thead th { position: sticky; top: 0; background: #f4f4f4; z-index: 2; }
        th { cursor: pointer; }
        th:hover { background-color: #ddd; }
        .form-container { margin-bottom: 20px; display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
        input, button { padding: 8px; margin-right: 5px; }
        /* Pequeno ajuste para o campo de busca */
        #searchInput { min-width: 180px; }

        /* botão excluir */
        .delete-btn {
            background:#e74c3c;
            color:white;
            border:none;
            padding:6px 10px;
            border-radius:4px;
            cursor:pointer;
            font-size:0.9rem;
            margin-left:6px;
        }
        .delete-btn:hover { background:#c0392b; }

        .qty-btn {
            background:#3498db;
            color:white;
            border:none;
            padding:6px 8px;
            border-radius:4px;
            cursor:pointer;
            font-size:0.85rem;
        }
        .qty-btn:hover { background:#2b81b7; }

        /* footer icon styles */
        .footer-icons {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-left: 12px;
        }
        .footer-icons a {
            color: #9e9e9e;
            text-decoration: none;
            font-size: 1.05rem;
            width: 34px;
            height: 34px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            background: rgba(255,255,255,0.06);
            transition: color 150ms ease, background 150ms ease;
        }
        .footer-icons a:hover {
            color: #21fc04;
            background: rgba(255,255,255,0.12);
        }

        @media (max-width: 520px) {
            .form-container { flex-direction:column; align-items:stretch; }
            input, button { width:100%; margin-right:0; }
        }
    </style>
</head>
<body>

    <h1>Gestão de Produtos</h1>

    <div class="form-container">
        <input type="text" id="productName" placeholder="Nome do Produto">
        <input type="number" id="productQuantity" placeholder="Quantidade" min="0">
        <input type="date" id="productDate">
        <button onclick="addProduct()">Adicionar Produto</button>

        <!-- Campo de busca e botão -->
        <input type="text" id="searchInput" placeholder="Buscar produto...">
        <button onclick="searchProducts()">Buscar</button>
    </div>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th onclick="sortTable(0)">Nome do Produto</th>
                    <th onclick="sortTable(1)">Data de Cadastro</th>
                    <th onclick="sortTable(2)">Quantidade</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="productList">
                <!-- Linhas de produtos serão adicionadas aqui via JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
        const productList = document.getElementById('productList');
        const STORAGE_KEY = 'tabela_produtos_v1';
        let products = []; // Array para armazenar os dados dos produtos
        let sortDirection = { 0: 1, 1: 1, 2: 1 }; // 1 = asc, -1 = desc

        function saveProductsToStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(products));
        }

        function loadProductsFromStorage() {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (raw) {
                try {
                    products = JSON.parse(raw);
                    // garante que tenha quantity (compatibilidade com versões antigas)
                    products = products.map(p => ({ id: p.id, name: p.name, date: p.date, quantity: (p.quantity || 1) }));
                } catch (e) {
                    products = [];
                }
            } else {
                products = [];
            }
        }

        function addProduct() {
            const nameInput = document.getElementById('productName');
            const quantityInput = document.getElementById('productQuantity');
            const dateInput = document.getElementById('productDate');
            const name = nameInput.value.trim();
            const date = dateInput.value;
            const quantity = parseInt(quantityInput.value, 10);

            if (!name || !date) {
                alert('Por favor, preencha nome e data.');
                return;
            }
            if (!Number.isInteger(quantity) || quantity <= 0) {
                alert('Quantidade deve ser um número inteiro maior que zero.');
                return;
            }

            const id = Date.now();
            products.push({ id, name, date, quantity });
            saveProductsToStorage();
            renderTable();
            nameInput.value = '';
            dateInput.value = '';
            quantityInput.value = '';
        }

        // renderTable agora aceita uma lista opcional para mostrar (padrão: todos os produtos)
        function renderTable(list = products) {
            productList.innerHTML = ''; 
            
            if (!list.length) {
                productList.innerHTML = '<tr><td colspan="4" style="text-align:center;color:#666;padding:12px;">Nenhum produto encontrado</td></tr>';
                return;
            }

            list.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${escapeHtml(product.name)}</td>
                    <td>${new Date(product.date + 'T00:00:00').toLocaleDateString('pt-BR')}</td>
                    <td style="text-align:center">${product.quantity}</td>
                    <td style="white-space:nowrap">
                        <button class="qty-btn" onclick="changeQuantity(${product.id}, -1)">Retirar</button>
                        <button class="qty-btn" onclick="changeQuantity(${product.id}, 1)">Adicionar</button>
                        <button class="delete-btn" onclick="deleteProduct(${product.id})">Excluir</button>
                    </td>
                `;
                productList.appendChild(row);
            });
        }

        function sortTable(columnIndex) {
            const dir = sortDirection[columnIndex] || 1;

            products.sort((a, b) => {
                if (columnIndex === 0) {
                    return dir * a.name.localeCompare(b.name);
                } else if (columnIndex === 1) {
                    const dateA = new Date(a.date);
                    const dateB = new Date(b.date);
                    return dir * (dateA - dateB);
                } else if (columnIndex === 2) {
                    return dir * (a.quantity - b.quantity);
                }
                return 0;
            });

            sortDirection[columnIndex] = -dir;
            saveProductsToStorage();
            const q = document.getElementById('searchInput').value.trim();
            if (q) searchProducts(); else renderTable();
        }

        // Busca por nome (ou por data formatada). Se campo vazio, mostra todos.
        function searchProducts() {
            const q = document.getElementById('searchInput').value.trim().toLowerCase();
            if (!q) {
                renderTable();
                return;
            }
            const filtered = products.filter(p => {
                const nameMatch = p.name.toLowerCase().includes(q);
                const dateStr = new Date(p.date + 'T00:00:00').toLocaleDateString('pt-BR').toLowerCase();
                const dateMatch = dateStr.includes(q);
                const qtyMatch = String(p.quantity).includes(q);
                return nameMatch || dateMatch || qtyMatch;
            });
            renderTable(filtered);
        }

        function changeQuantity(id, delta) {
            const idx = products.findIndex(p => p.id === id);
            if (idx === -1) return;
            products[idx].quantity = Math.max(0, products[idx].quantity + delta);
            if (products[idx].quantity === 0) {
                // remove automaticamente quando chega a zero
                products.splice(idx, 1);
            }
            saveProductsToStorage();
            const q = document.getElementById('searchInput').value.trim();
            if (q) searchProducts();
            else renderTable();
        }

        function deleteProduct(id) {
            if (!confirm('Deseja excluir este produto?')) return;
            const idx = products.findIndex(p => p.id === id);
            if (idx === -1) return;
            products.splice(idx, 1);
            saveProductsToStorage();
            const q = document.getElementById('searchInput').value.trim();
            if (q) searchProducts();
            else renderTable();
        }

        // Pequena função para evitar injeção ao inserir texto no innerHTML
        function escapeHtml(text) {
            const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
            return String(text).replace(/[&<>"']/g, m => map[m]);
        }

        // Carrega produtos salvos ao abrir a página
        document.addEventListener('DOMContentLoaded', () => {
            loadProductsFromStorage();
            renderTable();
        });
    </script>

    <footer>
        <p>2025-DEV-Lucas-Silva</p>
        <a class="contato" href="https://github.com/DEV-Lucas-Silva" target="_blank" rel="noopener">Contato</a>

        <!--  ajustar hrefs para seus links/telefone  -->
        <span class="footer-icons">
            <a href="mailto:lucastumblr1997@gmail.com" title="E-mail" aria-label="E-mail" target="_blank" rel="noopener">
                <i class="fas fa-envelope"></i>
            </a>
            <a href=" https://www.linkedin.com/in/lucas-santos-silva-521aba297?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=ios_app" title="LinkedIn" aria-label="LinkedIn" target="_blank" rel="noopener">
                <i class="fab fa-linkedin-in"></i>
            </a>
            <a href="https://wa.me/5511998222517" title="WhatsApp" aria-label="WhatsApp" target="_blank" rel="noopener">
                <i class="fab fa-whatsapp"></i>
            </a>
        </span>

    
    </footer>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js" 
    integrity="sha512-Tn2m0TIpgVyTzzvmxLNuqbSJH3JP8jm+Cy3hvHrW7ndTDcJ1w5mBiksqDBb8GpE2ksktFvDB/ykZ0mDpsZj20w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


</body>
</html>
